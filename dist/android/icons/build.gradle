apply plugin: 'com.android.library'
apply plugin: 'maven'

final IS_SNAPSHOT = System.env.TRAVIS_BRANCH != 'master' || System.env.TRAVIS_PULL_REQUEST != 'false'

configurations {
    deployerJars
}

android {
    compileSdkVersion 26
    buildToolsVersion "26.0.2"

    defaultConfig {
        minSdkVersion 17
        targetSdkVersion 26
        versionCode ((System.env.CI_BUILD_NUMBER ?: 1) as Integer)
        versionName System.env.VERSION_NAME ?: "snapshot"

        testInstrumentationRunner "android.support.test.runner.AndroidJUnitRunner"

    }
    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
    }
}

dependencies {
    deployerJars "org.apache.maven.wagon:wagon-http:2.2"
}

uploadArchives {
    repositories.mavenDeployer {
        configuration = configurations.deployerJars
        repository(url: "https://nexus.blt.meetup.com/content/repositories/${IS_SNAPSHOT ? 'snapshots' : 'releases'}") {
            authentication(userName: "deployment", password: System.env.NEXUS_DEPLOY_PASSWD)
            pom.project {
                name "swarm-icons android"
                groupId "com.meetup"
                artifactId "swarm-icons-android"
                version (System.env.VERSION_NAME ?: "1.0.0") + (IS_SNAPSHOT ? "-SNAPSHOT" : "")
                url "https://github.com/meetup/swarm-icons"
                organization {
                    name "Meetup"
                    url "https://www.meetup.com/"
                }
                scm {
                    url "https://github.com/meetup/swarm-icons"
                    connection 'scm:git:git://github.com/meetup/swarm-icons.git'
                    developerConnection 'scm:git:git@github.com:meetup/swarm-icons.git'
                }
            }
        }
    }
}
